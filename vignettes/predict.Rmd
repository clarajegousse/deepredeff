---
title: "More in predicting sequences"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{predict}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

How do you choose specify the taxon before predicting and what if your input data is not a FASTA file and you have different input file?

`deepredeff` allows to you to choose the taxon type depending on your input data. `deepredeff` also allows you to predict effector protein given amino acid sequences in different format. Format that can be used for this version are string, fasta, dataframe, AAString, and AAStringSet. 

In this vigenette, we will walk you through the steps. The function to predict an effector is `predict_effector()`. There are three different taxa available in this version, which are `bacteria`, `fungi`, `oomycete`. If you are not sure about the taxon of your input data, then you choose `all` option (set as a default value for taxon). 

For each taxon, `deepredeff` uses different model. These models are: 

- `bacteria`: `ensemble_weighted`, which is an weighted ensemble model of CNN-LSTM, CNN-GRU, GRU Embedding, and LSTM-Embedding. 
- `fungi`: CNN-LSTM.
- `oomycete`: CNN-LSTM. 
- `all`: `ensemble_weighted`, which is an voting ensemble model of CNN-LSTM, CNN-GRU, GRU Embedding, and LSTM-Embedding. 

The model used for your prediction will also be shown when you run the function `predict_effector()` or when you run `summary()`.


```{r include=FALSE}
# Load libraries
library(dplyr)
library(deepredeff)
```

Note that for each section below, you can use any of input format supported by `deepredeff`.  

## Predict fungal effectors

Let us take example of fungal sequences in data frame format called `input_fungi_df` as shown below:

```r
input_fungi_df 
```


```{r echo=FALSE}
input_fungi_df <- system.file("extdata/example/fungi_sample.fasta", package = "deepredeff")  %>%
      deepredeff::fasta_to_df() %>% 
      mutate(sequence = stringr::str_replace_all(sequence, "(.{50,}?)", "\\1 "))

knitr::kable(input_fungi_df, "html") %>% 
  kableExtra::column_spec(column = 2, width = "50em", monospace = TRUE) %>% 
  kableExtra::column_spec(column = 1, monospace = TRUE)
```

Since we know that we have fungal sequences, then you can specify the model to `taxon= fungi`. 

```r
pred_fungi <- deepredeff::predict_effector(
  input = input_fungi_df,
  taxon = "fungi"
)
#> Loaded models successfully!
#> Model used for taxon fungi: cnn_lstm.
```

As we can see, when the prediction process is finished, you will get an information about what model is used for taxon fungi. You can see the prediction result below. 

```r
pred_fungi %>% 
  dplyr::mutate(name = substr(name, 1, 25), 
                sequence = substr(sequence, 1, 25))
#>                         name                  sequence     s_score   prediction
#> 1  tr|A0A0A0S3X0|A0A0A0S3X0_ MRLANFLFYLAPMIVSSLAFDFVPL 0.949224353     effector
#> 2  tr|A0A0A2ILW0|A0A0A2ILW0_ MFFPSLILAAGSLSTLIQAIPHGAK 0.976694226     effector
#> 3  tr|A0A0A2JB06|A0A0A2JB06_ MDKMLFSFLRLCFVLLTVWTTWVAA 0.980522096     effector
#> 4  tr|A0A0A2JVC2|A0A0A2JVC2_ MMAPKSLQTGLLILLLAKLKLAWGM 0.954952955     effector
#> 5  tr|A0A0A2JY92|A0A0A2JY92_ MGLFRIDFLALWLLLLRLATAAAPV 0.981008768     effector
#> 6  tr|F9XPG6|F9XPG6_ZYMTI Un MKLLTLAIGLLTATALATPLITDAM 0.087577999 non-effector
#> 7  tr|G2XB99|G2XB99_VERDV Hy MRAAVLVTLATGALAARPYINEPDT 0.038996011 non-effector
#> 8  tr|G2WR20|G2WR20_VERDV Ci MKTLATALLFAASAAAQAGPWAQCG 0.022782624 non-effector
#> 9  tr|G2X460|G2X460_VERDV IN MRLTSVASGLALLSIQAAAHPGHDL 0.004808949 non-effector
#> 10 tr|A0A0D1C4R8|A0A0D1C4R8_ MKFTASLIALGALLVGAASTEAAAV 0.106814429 non-effector
```

The summary of the prediction result above can be seen by running `summary()` as follows:

```r
summary(pred_fungi)
#> Total sequences in input data: 10
#> ---
#> Taxon chosen: fungi
#> Model type used: cnn_lstm
#> 
#> Total sequences predicted as effector: 5
#> Total sequences predicted as non-effector: 5
```

You can plot the result using `plot()`. 

```r
plot(pred_fungi)
```

![](https://i.imgur.com/Larrcgl.png)

## Predict oomycete effectors

In this section, we will show you how to predict effector from oomycete taxon. Let us take AAStringSet object data called `input_oomycete_aastringset` as shown below:

```r
input_oomycete_aastringset
#> AAStringSet object of length 10:
#>      width seq                                              names               
#>  [1]   820 MVKLYCAVVGVAGSAFSVRVDES...SKKGKTAMILSRMHYDDDEADL sp|A0A0M5K865|CR1...
#>  [2]   111 MRLAQVVVVIAASFLVATDALST...FQRYQKKANKIIEKQKAAAKNA tr|A5YTY8|A5YTY8_...
#>  [3]   123 MGLHKGFFVAVALLALLIVAAPA...HDIPDWLLQLQAFLSVGLHHLT tr|A7L812|A7L812_...
#>  [4]   415 MRFALITPMVLAFSSILMYVTHS...SLERASFIAKKFDTWHPPSSSS tr|B2C6F8|B2C6F8_...
#>  [5]   220 MRVCSVLLVAAAALIATSNAVEP...ELPAKEYKRLNKAWVQYRRKHK tr|C0LF23|C0LF23_...
#>  [6]   598 MVYSRSTSTRAYVKAVALCALSL...VCRFCKVRTTDQSAAFVDCPSA tr|G4Z8J9|G4Z8J9_...
#>  [7]   246 MTRLLLLALPGILAGDFAELDPE...CFFQVFYIKSLLDSPRKARSWV tr|G4ZVW1|G4ZVW1_...
#>  [8]   378 MMESPLPWWLFGTAGLIATTLTV...LRFARPGGLLGAAVATAASKVV tr|G4Z8A0|G4Z8A0_...
#>  [9]   409 MAKWWLVATLSASFASVVLGACP...TGTCECFAGHMGLACQKQEALV tr|G5A7C4|G5A7C4_...
#> [10]    71 MNLKLCVVALFSTAIAASLPSTN...ESRGGNFEACCFSSCRTGSPCN tr|G4ZGN2|G4ZGN2_...
```

To predict oomycete effector, you can specify the model to `taxon= oomycete`. 

```r
  pred_oomycete <- deepredeff::predict_effector(
  input = input_oomycete_aastringset,
  taxon = "oomycete"
)
#> Loaded models successfully!
#> Model used for taxon oomycete: cnn_lstm.
```


```r
# View results
pred_oomycete %>% 
  dplyr::mutate(name = substr(name, 1, 25), 
                sequence = substr(sequence, 1, 25))
#>                         name                  sequence   s_score   prediction
#> 1  sp|A0A0M5K865|CR108_PHYSO MVKLYCAVVGVAGSAFSVRVDESDT 0.3380925 non-effector
#> 2  tr|A5YTY8|A5YTY8_PHYSO Av MRLAQVVVVIAASFLVATDALSTTN 0.7775228     effector
#> 3  tr|A7L812|A7L812_PHYSO Pu MGLHKGFFVAVALLALLIVAAPADA 0.4298682 non-effector
#> 4  tr|B2C6F8|B2C6F8_9STRA RX MRFALITPMVLAFSSILMYVTHSNV 0.6125270     effector
#> 5  tr|C0LF23|C0LF23_PHYSO Av MRVCSVLLVAAAALIATSNAVEPSA 0.5669487     effector
#> 6  tr|G4Z8J9|G4Z8J9_PHYSP Un MVYSRSTSTRAYVKAVALCALSLAS 0.3983551 non-effector
#> 7  tr|G4ZVW1|G4ZVW1_PHYSP GO MTRLLLLALPGILAGDFAELDPEAA 0.4206038 non-effector
#> 8  tr|G4Z8A0|G4Z8A0_PHYSP Un MMESPLPWWLFGTAGLIATTLTVGA 0.4387988 non-effector
#> 9  tr|G5A7C4|G5A7C4_PHYSP Un MAKWWLVATLSASFASVVLGACPNK 0.2261022 non-effector
#> 10 tr|G4ZGN2|G4ZGN2_PHYSP Pc MNLKLCVVALFSTAIAASLPSTNAA 0.2656690 non-effector
```

The summary of the prediction result and plot of the class distribution result can be seen by running the following commands:

```r
summary(pred_oomycete)
#> Total sequences in input data: 10
#> ---
#> Taxon chosen: oomycete
#> Model type used: cnn_lstm
#> 
#> Total sequences predicted as effector: 3
#> Total sequences predicted as non-effector: 7
```

```r
plot(pred_oomycete)
```

![](https://i.imgur.com/LKUgGLD.png)



## Predict bacterial effectors

To predict bacterial sequences, let us take an example of data in string format. 

```r
input_bacteria_strings
#>  [1] "MPINRPAFNLKLNTAIAQPTLKKDAGAELRRLNQSEVRANTQTRFAVNHRAPTYDVAQSALGENHGGWTAANHFKMTGSEVFIHMDRLEPNCKGEFAGDKIHLSVAPEDVPDAFNAIGKILQASDSPVDSWKVTDMKCLQAEMPAAKQRVALGAQFTIYAKPDREDNTYSPEYMGKMRGMISSIEQELSAAGVRQSSHRPDSDVSPGHWSYASYRNEHKSNRSGTSNQHRNLEAEPFFQLVSFSDGASGSSRSSADHQALLPPPWAR"
#>  [2] "MQFMSRINRILFVAVVSLLSVLGCCVAAAPAQAVDRIARVSLPVRAGTHLIFSDSQGPARSADYDCTAGAVLTGSGILSRISPYQRAVRYVVTAKHCGGRGAHVRVGDVQVGSVIWESSDADLSIVRIEPLQTTRRSCYPTSAGIRCTLVNDYEPRASGEVFGARNRSGQESSVQVAGTKVPADREIFCTSGAITGILCNWVSAPPPRGLEIGSHQVVAETFSAATRQGDSGGPVVSRDMKIIGVICDGGLPGSGDDTYMSYLPISVLFREQPYYILATS"
#>  [3] "MDPIRSRTPSPARELLPGPQPDRVQPTADRGGAPPAGGPLDGLPARRTMSRTRLPSPPAPSPAFSAGSFSDLLRQFDPSLLDTSLLDSMPAVGTPHTAAAPAECDEVQSGLRAADDPPPTVRVAVTAARPPRAKPAPRRRAAQPSDASPAAQVDLRTLGYSQQQQEKIKPKVGSTVAQHHEALVGHGFTHAHIVALSRHPAALGTVAVKYQDMIAALPEATHEDIVGVGKQWSGARALEALLTVAGELRGPPLQLDTGQLVKIAKRGGVTAVEAVHASRNALTGAPLNLTPAQVVAIASNNGGKQALETVQRLLPVLCQAHGLTPAQVVAIASHDGGKQALETMQRLLPVLCQAHGLPPDQVVAIASNIGGKQALETVQRLLPVLCQAHGLTPDQVVAIASHGGGKQALETVQRLLPVLCQAHGLTPDQVVAIASHDGGKQALETVQRLLPVLCQAHGLTPDQVVAIASNGGGKQALETVQRLLPVLCQAHGLTPDQVVAIASNGGKQALETVQRLLPVLCQAHGLTPDQVVAIASHDGGKQALETVQRLLPVLCQTHGLTPAQVVAIASHDGGKQALETVQQLLPVLCQAHGLTPDQVVAIASNIGGKQALATVQRLLPVLCQAHGLTPDQVVAIASNGGGKQALETVQRLLPVLCQAHGLTPDQVVAIASNGGGKQALETVQRLLPVLCQAHGLTQVQVVAIASNIGGKQALETVQRLLPVLCQAHGLTPAQVVAIASHDGGKQALETVQRLLPVLCQAHGLTPDQVVAIASNGGGKQALETVQRLLPVLCQAHGLTQEQVVAIASNNGGKQALETVQRLLPVLCQAHGLTPDQVVAIASNGGGKQALETVQRLLPVLCQAHGLTPAQVVAIASNIGGKQALETVQRLLPVLCQDHGLTLAQVVAIASNIGGKQALETVQRLLPVLCQAHGLTQDQVVAIASNIGGKQALETVQRLLPVLCQDHGLTPDQVVAIASNIGGKQALETVQRLLPVLCQDHGLTLDQVVAIASNGGKQALETVQRLLPVLCQDHGLTPDQVVAIASNSGGKQALETVQRLLPVLCQDHGLTPNQVVAIASNGGKQALESIVAQLSRPDPALAALTNDHLVALACLGGRPAMDAVKKGLPHAPELIRRVNRRIGERTSHRVADYAQVVRVLEFFQCHSHPAYAFDEAMTQFGMSRNGLVQLFRRVGVTELEARGGTLPPASQRWDRILQASGMKRAKPSPTSAQTPDQASLHAFADSLERDLDAPSPMHEGDQTGASSRKRSRSDRAVTGPSAQHSFEVRVPEQRDALHLPLSWRVKRPRTRIGGGLPDPGTPIAADLAASSTVMWEQDAAPFAGAADDFPAFNEEELAWLMELLPQSGSVGGTI"
#>  [4] "MSIGRSKSVAGASASHALASGENGSPQPQTVTLLAGATRRRRNSGLLCELQSMCKRTLRAASQTIIFPFYSKTGTTPTRAQPKPDVVPALKPAPRRMRPPAAPGRKHQRNVDAVVPPAMATSPRAEIRFPLTTADAQRYLRAQWRQAETGGRFDQAAVDRLTTTLTARLLATSAATGNGVHEDSGEKACARAIMVSDALAQATGGDPARAHDALLALLDTTSHADARVQADVLALQTALGMTAIGLDTLLAIAPHVLPQRGLAEGSAAPEIQREALRHALRAADHLLRRKPADAPGPTSLEALAALADPVLPAVERGRPGSSAGASVAPPGKAPAWLADPGNALAIKALHAANALRADPAAQCPPHLAQAYLAWRNGFDREGPGTDLAKAQQRLFKLFTYAERAARTGMAARAAAGFFGTQKSPLSALQNFGTAGVMLGHPDDEFARFTAALAPVKTQLADRLKAASTSRALKTRCAVRLAAIEQWERRMASKGLRSTFRFSSRDLEAVAARARPLLSNRVALHADGSPADLALDPHRNRDAIRAEVKPLRGMTPAQLRTWADEAWRLSGQAVPEPVRANIDLVESRLAGDIRPKPGDTNAQLDAIGALVKQMPDIYDIRVSSGGTVGLGGVPSQSLAALSSHLGVPHVSVLPDGGYLQGRHAVIDIGSNQHFGHLFIGTESRKSLYGGLGGYAGWSFGQDGMANVGVSDGLRRSRDWGGPRGVTIRTRRSDDEQPGRPDAWRTTMLEVLHAARSAGPNSDAPRNAREMWGSLARRFWNDPACSINWTDSRSTTSATSGSASATARVGTADTKWGPALGATLRHVARAAHRQWDKTGNHAIDVSTHNSGRATAVAATLVEALPGIPVPNGSGHLAALSFPTQPYVGIGTTLFATQTNAALRIGRDSGRIIPKHTFRDTEFGTFKAFKQFVDTHRSEWLTALGGTDDARRRLDEMVATVKARATAGNLIMGERMHMTDEAARRLDFLFHRKQRFDRIPAPTPMQARERASIDADIRQMLASENSWRRQALYVLEALGVQRTVGLSFLLNAQSTQAVSGVRELAGLSPE"
#>  [5] "MPPPIRNARTTPPSFDPSAAGDDLRATPPRVAAATPTHRTAPSQLAGLPSRPRAQPPQQDPTPTPLALHGNTHTGSATGRLIALALANPAANRTPGRLAGGLHLPSIDNGNPVLASLNVASGELAEIGAAALLATRLRLPSIALDGPRARGPAATLLAGLEHRTRALSLAQEPGGLGPGHPPLAVLPDIVAAALANSNSLRDLLDRHPASVLANRLRGVGPAQPAAAPSLGHAQRAAQILEGWAQQCQLPPKTVDAWRPVLNQEESRPFVSLLARLNGCASFRPAHRAESLKELGGILQLAAHNDAYRARCFDICGGADANCHDNVDVIFGNLRLAARDPSYHGNAQLHEVLSYHNRCMPWTLIDDFVSHRFGRGDQLERALALRVRLSDILPITTPAMLHHDIARIDNAHEREARAYISAHLGTQEHLLRNLSRSPAWRQFLEQQRPVEFAANTLLWESALQDVMAKPAGDSAMADAPRTASTAAPGSRTEALAQARAMPGIGTGQAFQHRQENATAMLAETMTRKLVMESAPPPDETGAHAALLTDPDWLAYLQKEHPEDRAFSPADMHAAERHDLLMRLTRQEIAEARGMVQPHAGAPTDHG"
#>  [6] "MSHMTFNTWKAGLWRLAAAAVLSLLPVVARAAVPGITGPTFDLTAQPGRANQPDGASVYSWGYGCNPRTVPGFLPSVNPLAGQNCPGMQLPGPTLIVHQGDVVTVTLTNNLPPAAGNTSILFPGFQVCAGTLDPNTGACSGTPTGVQGLLTREAQTGKTVTYTFIATTPGTHAYYSGTQGDLQVEMGLYGALIVLPTASGSVAVPAGCRAVSSLLPDGQPDYRNAAAAYNHSMACYDREYLFQFSEIDPAIHVQAEQQAGLPCAQPAGCMIVRTEPYHPAYFMVNGRSMPDDMDTNYAPQYPSQPYNGNPHMHPGELVLLRIIGTGRWQHPFHEHGNHVRVLARDGNLLLSQGDPSKVAGPLLFTTTTTPGLAMDGIFYWTGRGLNWDVYGHKPGDGSVCIPDANGYYTQDPTAPNYYEWCADHDKPLEAHPFGDVNSGGPVTLPDPNIFSNGAWYGGSPYLGPDATIRAVGATGTTPPTGTIANPPTTEAGFAFMWHSHNEREITTNNIFPGGMMMMMLVDPQAFVINEAN"
#>  [7] "MKLHFSLRLLTALSLTGATFLAQAADFTVAYQTTVDPAKVAQADNAYEKATDSKIAWRKFDNGADVITAIASSDVQIGYLGSSPFTAAATRKLPVETFLIATQIGAAEALVARNGSGINSPQDLIGKKIAVPFVSTGHYSLLAALKHWNIDPAKVTILNLAPPAIAAAWKRGDIDATYVWDPALGVAKETGKVLITSGELAKVGAPTFDAWIVRKDFASKHPEVVKAFAKVTLDAYAQYRQDPAAWIANPANVDKLTRLSGAKASDVPELLQGNVYPLATEQSSLLGTPTIEAVAKTAAFLKEQGKVDAVLPDYSPYVSNAFIPQ"
#>  [8] "MHRGPSFVKACAFVLSASFMLANTVQAAEGSKLDAVLKRGNLVVGTGSTNAPWHFQGADGKLQGFDIDIGRIIAKGLFNDPSKVEFVVQSSDARIPNLLTDKVDISCQFITVTASRAQQVAFTLPYYREGVALLLPANSKYKEIDDLKAAGDDVTVAVLQNVYAEELVHQALPKAKVDQYDSVDLMYQAINSGRADTAATDQSSVKYLMVQNPGRYRSPAFAWSPQTYACAVKRGDQDWLNFVNTALHEAMTGVEFPAYAASFKQWFGVDLPVPAIGFPMEYK"
#>  [9] "MRRQPSLTLRSTLAFALVAMLTVSGAGLYLYQSIEETVMQRSDHAVLARLDHFRKLLRYDLTMGNLKGSPQLFENMLDSEEDIFIIGEPGKSPVISVNPQHAPLPELPTVAQDQPLRVDDLRSGMSLQGVPLRAAAVQVMSNGVEVRLQAAHLMVKEMAMLASFRQRIYIAVALAFLITAALGYVLLRRGLRPLRRMAAHAAAITPASLHKRLDSRDTPVELQQLSDAFNAMLDRLDDGYRRLMQFSADLAHEIRTPVGSLMGHCQVALRQNRSADEYQALLASNLEELERISRLVESILFLARADEAQAALERQALDMHDELQRVAGYFEGLAEERNLTLSTHGQGTLLADPILLRRALSNLVANAIRYADEDSEILMRVTAVDRHWKIDVENQGPVLPEATLARLFDRFYRGDASRHERSDSNGLGLAIVTAIMQLHGGRVEVAQPAVGRICFSLIFPAA"
#> [10] "MLSSNRRLLRLLPLASLLLTACGLHTQPQKPGQSPTAVQWRQHQQAVQNIHQYQTRGAFAWLSDRQKVYARFNWQQTAPDRYRLLLTNPLGSTELQLDQQGQVAQIVDNKGKRYVSNDAAQMISQLTGMTIPLNNLRQWMVGLPGDAADFTLDDQYRLREVNYSEEGLQWHVTYQAYHNEQNPQLPASIELQQGDERIKLKMDSWTLK"
```

To predict oomycete effector, you can specify the model to `taxon= bacteria`. 

```r
pred_bacteria <- deepredeff::predict_effector(
  input = input_bacteria_strings,
  taxon = "bacteria"
)
#> Loaded models successfully!
#> Model used for taxon bacteria: ensemble_weighted.
```


```r
# View results
pred_bacteria %>%
  dplyr::mutate(sequence = substr(sequence, 1, 25))
#>                     sequence    s_score   prediction
#> 1  MPINRPAFNLKLNTAIAQPTLKKDA 0.94834236     effector
#> 2  MQFMSRINRILFVAVVSLLSVLGCC 0.07981774 non-effector
#> 3  MDPIRSRTPSPARELLPGPQPDRVQ 0.99433611     effector
#> 4  MSIGRSKSVAGASASHALASGENGS 0.84184432     effector
#> 5  MPPPIRNARTTPPSFDPSAAGDDLR 0.99537852     effector
#> 6  MSHMTFNTWKAGLWRLAAAAVLSLL 0.06455158 non-effector
#> 7  MKLHFSLRLLTALSLTGATFLAQAA 0.04928582 non-effector
#> 8  MHRGPSFVKACAFVLSASFMLANTV 0.30616181 non-effector
#> 9  MRRQPSLTLRSTLAFALVAMLTVSG 0.07221440 non-effector
#> 10 MLSSNRRLLRLLPLASLLLTACGLH 0.04899144 non-effector
```

The summary of the prediction result and plot of the class distribution result can be seen by running the following commands:

```r
summary(pred_bacteria)
#> Total sequences in input data: 10
#> ---
#> Taxon chosen: bacteria
#> Model type used: ensemble_weighted
#> 
#> Total sequences predicted as effector: 4
#> Total sequences predicted as non-effector: 6
```

```r
plot(pred_bacteria)
```
![](https://i.imgur.com/62iaXbg.png)
